<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MBTI Compatibility Mind Map</title>
  <style>
    #circle-container {
      position: relative;
      width: 500px;
      height: 500px;
      margin: 40px auto;
      border-radius: 50%;
      background-color: #f9f9f9;
    }

    .type {
      position: absolute;
      width: 100px;
      text-align: center;
      transform: translate(-50%, -50%);
      font-size: 14px;
    }

    #center {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 120px;
      height: 120px;
      line-height: 120px;
      text-align: center;
      background: #fff3cd;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      border: 2px solid #333;
      font-weight: bold;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 0;
    }

    .type, #center {
      z-index: 1;
    }
  </style>
</head>
<body>
  <h2 style="text-align:center;">MBTI Compatibility Mind Map</h2>
  <div id="circle-container">
    <canvas id="lines" width="500" height="500"></canvas>
    <div id="center">You</div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getFirestore, collection, getDocs, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBTUI2nTJCAr4xn0FYaa6SGV9xbaKsK1kg",
    authDomain: "mbti-project-3c324.firebaseapp.com",
    projectId: "mbti-project-3c324",
    storageBucket: "mbti-project-3c324.appspot.com",
    messagingSenderId: "539055979955",
    appId: "1:539055979955:web:078e6481299a75b3735fc6"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const yourMBTI = localStorage.getItem("userMBTI");
  const resultArea = document.getElementById("result-map");

  const matchTable = {
    'INFJ': { best: 'ENFP', worst: 'ESTP' },
    'ENFP': { best: 'INFJ', worst: 'ISTJ' },
    'ISTJ': { best: 'ESFP', worst: 'ENFP' },
    'ENTP': { best: 'INFJ', worst: 'ISFJ' },
    'ESTP': { best: 'ISFJ', worst: 'INFJ' },
    // Add more types...
  };

  function createCircle(type, label, color) {
    const div = document.createElement('div');
    div.style.width = '80px';
    div.style.height = '80px';
    div.style.borderRadius = '50%';
    div.style.background = color;
    div.style.color = '#fff';
    div.style.display = 'flex';
    div.style.alignItems = 'center';
    div.style.justifyContent = 'center';
    div.style.margin = '10px';
    div.innerText = label;
    div.title = type;
    return div;
  }

  async function loadResults() {
    const querySnapshot = await getDocs(collection(db, "results"));
    const match = matchTable[yourMBTI] || {};

    const container = document.createElement('div');
    container.style.display = 'flex';
    container.style.flexWrap = 'wrap';
    container.style.justifyContent = 'center';

    querySnapshot.forEach((doc) => {
      const data = doc.data();
      const type = data.type;

      if (type === yourMBTI) {
        container.appendChild(createCircle(type, "You", "#3498db"));
      } else if (type === match.best) {
        container.appendChild(createCircle(type, "Perfect", "#2ecc71"));
      } else if (type === match.worst) {
        container.appendChild(createCircle(type, "Disaster", "#e74c3c"));
      } else {
        container.appendChild(createCircle(type, type, "#bdc3c7"));
      }
    });

    resultArea.innerHTML = '';
    resultArea.appendChild(container);
  }

  loadResults();
</script>
</body>
</html>
